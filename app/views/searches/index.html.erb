<!DOCTYPE html>
<html>
<head>
  <title>Search Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css", media: "all", integrity: "sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD", crossorigin: "anonymous" %>
  <%= javascript_importmap_tags %>
  <style>
    html, body {
      height: 100%;
    }
    body {
      background-color: #f7f9fc;
    }
    #search-container {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 100%;
    }
    .suggestion-item {
      cursor: pointer;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    .suggestion-item:hover {
      background-color: #f8f9fa;
    }
  </style>
</head>

<body>
  <div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div id="search-container" class="text-center">
      <h2 class="mb-4">Search Articles</h2>
      <div class="d-flex justify-content-center">
        <input type="text" id="searchBox" class="form-control" placeholder="Search for articles..." aria-label="Search" style="max-width: 400px;">
      </div>
      <div class="d-flex justify-content-center">
        <button class="btn btn-secondary" type="button" id="search-button" style="max-width: 400px; margin-top: 20px;">Search</button>
      </div>
      <ul id="suggestions" class="list-group mt-3">
        <!-- Suggestions will be populated here -->
      </ul>

      <!-- Top Searches -->
      <div class="mt-4">
        <h5>Top Searches</h5>
        <ul class="list-group">
          <% @top_searches.each do |query, count| %>
            <li class="list-group-item">
              <%= query %> - <%= count %> searches
            </li>
          <% end %>
        </ul>
      </div>

      <!-- Recent Searches -->
      <div class="mt-4">
        <h5>Recent Searches</h5>
        <ul class="list-group">
          <% @recent_searches.each do |search| %>
            <li class="list-group-item">
              <%= search.query %> - <%= search.created_at.strftime("%b %d, %Y %H:%M") %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('search-button').addEventListener('click', function() {
      const searchBox = document.getElementById('searchBox');
      const query = searchBox.value.trim();

      if (query) {
        // Log the search query
        logSearch(query);
        
        // Redirect to search results page
        window.location.href = `/search?query=${encodeURIComponent(query)}`;
      }
    });

    function logSearch(query) {
      fetch('/searches', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        },
        body: JSON.stringify({ query: query })
      })
      .then(response => response.json())
      .then(data => {
        console.log('Search logged:', data);
      });
    }
  </script>

</body>
</html>
